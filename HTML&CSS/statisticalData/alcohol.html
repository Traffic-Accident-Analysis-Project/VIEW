<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T.A.S 음주 정도</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="container">
      <div class="top-background-color">
        <header>
          <div class="circle-01"></div>
          <div class="circle-02"></div>
          <div class="circle-03"></div>
          <div class="row top">
            <a href="main.html">home</a>
            <i
              class="fa-solid fa-house-chimney"
              style="color: #eaeaea; margin-left: 5px; margin-top: 3px"
            ></i>
            <select name="lang-selbox" id="">
              <option value="korea">한글</option>
              <option value="eng">English</option>
            </select>
          </div>
          <div class="row header-category">
            <div class="logo">
              <a href="../main.html">
                <img src="../img/T.A.S-logo-black.png" alt="" />
              </a>
            </div>
            <div class="row category">
              <div class="category-link dropdown">
                <div class="link-button">통계 자료실</div>
                <div class="dropdown-content">
                  <a href="law.html">법규 위반</a>
                  <a href="alcohol.html">음주 정도</a>
                  <a href="road_type.html">도로 종류</a>
                  <a href="accident_type.html">사고 유형</a>
                  <a href="city_type.html">시도 별</a>
                </div>
              </div>
              <div class="category-link service-link">
                <a href="../intro-service.html">서비스 소개</a>
              </div>
              <div class="category-link client-link">
                <a href="../service_center.html">고객 센터</a>
              </div>
              <div class="category-link login-link">
                <a href="../login.html">로그인</a>
              </div>
            </div>
          </div>
        </header>
      </div>
      <!-- header end -->
      <div class="bottom-background-color">
        <div class="statistical-page-main">
          <div class="statistical-page-main-title">
        <h1>음주 정도</h1>
      </div>
      <div class="by-category-main-section">
        <div class="statistical-page-left-section-graph">
          <img src="../img/임시이미지.png" alt="" />
        </div>
        <div class="statistical-page-right-section">
          <div class="select-wrap">
            <div class="alcohol-sel alcohol-year">
              <input type="hidden" id="alcoholYearHidden" />
              <select name="alcohol-year" id="alcohol-year" onchange="alcoholYear(this.value)">
                <option value="">연도</option>
                <option value="2005">2005년</option>
                <option value="2006">2006년</option>
                <option value="2007">2007년</option>
                <option value="2008">2008년</option>
                <option value="2009">2009년</option>
                <option value="2010">2010년</option>
                <option value="2011">2011년</option>
                <option value="2012">2012년</option>
                <option value="2013">2013년</option>
                <option value="2014">2014년</option>
                <option value="2015">2015년</option>
                <option value="2016">2016년</option>
                <option value="2017">2017년</option>
                <option value="2018">2018년</option>
                <option value="2019">2019년</option>
                <option value="2020">2020년</option>
              </select>
            </div>
            <div class="alcohol-sel alcohol-month">
              <input type="hidden" id="alcoholMonthHidden" />
              <select name="alcohol-month" id="alcohol-month" onchange="alcoholMonth(this.value)">
                <option value="">월</option>
                <option value="전체">전체</option>
                <option value="1월">1월</option>
                <option value="2월">2월</option>
                <option value="3월">3월</option>
                <option value="4월">4월</option>
                <option value="5월">5월</option>
                <option value="6월">6월</option>
                <option value="7월">7월</option>
                <option value="8월">8월</option>
                <option value="9월">9월</option>
                <option value="10월">10월</option>
                <option value="11월">11월</option>
                <option value="12월">12월</option>
              </select>
            </div>
            <div class="alcohol-sel alcohol-or-not">
              <input type="hidden" id="alcoholOrNotHidden" />
              <select name="alcohol-or-not" id="alcohol-or-not" onchange="alcoholOrNot(this.value)">
                <option value="">가해자 음주 상태 선택</option>
                <option value="음주상태">음주 상태</option>
                <option value="음주운전">음주 운전</option>
                <option value="측정불능">측정 불능</option>
                <option value="해당없음">해당 없음</option>
                <option value="기타불명">기타 불명</option>
              </select>
            </div>
            <div class="alcohol-sel alcohol-degree">
              <input type="hidden" id="alcoholDegreeHidden" />
              <select name="alcohol-degree" id="alcohol-degree" onchange="alcoholDegree(this.value)">
                <option value="">가해자 음주 정도 선택</option>
                <!-- 음주상태 -->
                  <option class="allOption drunken-atate" value="0.03미만">0.03% 미만</option>
                  <option class="allOption drunken-atate" value="0.05미만">0.05% 미만</option>
                  <option class="allOption drunken-atate" value="0.030~0.049">0.030 ~ 0.049%</option>
                <!-- 음주운전 -->
                  <option class="allOption drunken-driving" value="측정불응">측정 불응</option>
                  <option class="allOption drunken-driving" value="0.05~0.09">0.05% ~ 0.09%</option>
                  <option class="allOption drunken-driving" value="0.10~0.14">0.10% ~ 0.14%</option>
                  <option class="allOption drunken-driving" value="0.15~0.19">0.15% ~ 0.19%</option>
                  <option class="allOption drunken-driving" value="0.20~0.24">0.20% ~ 0.24%</option>
                  <option class="allOption drunken-driving" value="0.25~0.29">0.25% ~ 0.29%</option>
                  <option class="allOption drunken-driving" value="0.30~0.34">0.30% ~ 0.34%</option>
                  <option class="allOption drunken-driving" value="0.35이상">0.35% 이상</option>
                <!-- 측정불능 -->
                  <option class="allOption drunken-measurable" value="측정불능">측정 불능</option>
                <!-- 해당없음 -->
                  <option class="allOption drunken-applicable" value="해당없음">해당 없음</option>
                <!-- 기타불명 -->
                  <option class="allOption drunken-unknown" value="기타불명">기타 불명</option>
              </select>
            </div>
            <button id="lookUpByLaw" type="button">조회하기</button>
          </div>
          <div class="accidents-dead-injury-card-wrap">
            <div class="accidents-card card-accidents hight">
              <h2>사고 건 수</h2>
              <i class="fa-solid fa-car-burst fa-3x"></i>
              <div id="accidentsAccidents" class="accidents-item">0</div>
            </div>
            <div class="accidents-card card-dead middle">
              <h2>사망자 수</h2>
              <i class="fa-solid fa-skull fa-3x"></i>
              <div id="accidentsDead" class="accidents-item">0</div>
            </div>
            <div class="accidents-card card-injury rower">
              <h2>부상자 수</h2>
              <i class="fa-solid fa-person-falling-burst fa-3x"></i>
              <div id="accidentsInjury" class="accidents-item">0</div>
            </div>
          </div>
          <div class="excel-down-button">
            <button type="button">Excel Downlod</button>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <img src="../img/T.A.S-logo.png" alt="" />
      <div class="footer-info">
        <p>email : jyg12770@google.com</p>
        <p>email : jyg12770@google.com</p>
      </div>
      <button
        type="button"
        style="cursor: pointer"
        onclick="window.scrollTo({top:0, left:0, behavior:'smooth'});"
      >
        top
      </button>
    </footer>
    </div>
  </body>
  <script
    type="module"
    src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
  ></script>
  <script
    nomodule
    src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
  ></script>
  <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"
  ></script>
  <script src="index.js"></script>
  <script>
    // option값을 input[hidden]에 넣기
    var alcoholYear = function (value) {
      $("#alcoholYearHidden").val(value);
    };
    var alcoholMonth = function (value) {
      $("#alcoholMonthHidden").val(value);
    };
    var alcoholOrNot = function (value) {
      $("#alcoholOrNotHidden").val(value);
    };
    var alcoholDegree = function (value) {
      $("#alcoholDegreeHidden").val(value);
    };

    allOptionHide();

    // 가해자 음주 상태 선택 안했을시 가해자 음주정도 옵션 숨기기
    function allOptionHide(){
      var alcoholOrNotHidden = $("#alcoholOrNotHidden").val();
      if (alcoholOrNotHidden == "") {
        $('.allOption').hide();
      }
    }

    // 가해자 음주 상태 선택 안했을시 가해자 음주정도 옵션 보이고 숨기기
    $("#alcohol-or-not").change(function () {
      var alcoholOrNotHidden = $("#alcoholOrNotHidden").val();
      if (alcoholOrNotHidden == "") {
        $('.allOption').hide();
      }
      if (alcoholOrNotHidden == "음주상태") {
        $(".drunken-atate").show();
        $(".drunken-driving").hide();
        $(".drunken-measurable").hide();
        $(".drunken-applicable").hide();
        $(".drunken-unknown").hide();
      }
      if (alcoholOrNotHidden == "음주운전") {
        $(".drunken-atate").hide();
        $(".drunken-driving").show();
        $(".drunken-measurable").hide();
        $(".drunken-applicable").hide();
        $(".drunken-unknown").hide();
      }
      if (alcoholOrNotHidden == "측정불능") {
        $(".drunken-atate").hide();
        $(".drunken-driving").hide();
        $(".drunken-measurable").show();
        $(".drunken-applicable").hide();
        $(".drunken-unknown").hide();
      }
      if (alcoholOrNotHidden == "해당없음") {
        $(".drunken-atate").hide();
        $(".drunken-driving").hide();
        $(".drunken-measurable").hide();
        $(".drunken-applicable").show();
        $(".drunken-unknown").hide();
      }
      if (alcoholOrNotHidden == "기타불명") {
        $(".drunken-atate").hide();
        $(".drunken-driving").hide();
        $(".drunken-measurable").hide();
        $(".drunken-applicable").hide();
        $(".drunken-unknown").show();
      }
      
    });

    // 조회하기 버튼 눌렀을 때 함수
    $("#lookUpByLaw").on("click", function () {
      // input[hidden]의 값을 변수에 담기
      var yearHidden = $("#alcoholYearHidden").val();
      var monthHidden = $("#alcoholMonthHidden").val();
      var alcoholOrNotHidden = $("#alcoholOrNotHidden").val();
      var degreeHidden = $("#alcoholDegreeHidden").val();

      // degreeHidden을 인코딩해줘야함
      var uri = encodeURI(degreeHidden);
      console.log(uri);
      if (
        yearHidden == "" ||
        monthHidden == "" ||
        alcoholOrNotHidden == "" ||
        degreeHidden == ""
      ) {
        alert("선택박스를 확인 해 주세요");
        return false;
      }
      // option으로 선택한 값에대한 data받아오는 ajax
      $.ajax({
        url:
          "http://localhost:8080/api/v1/alcohol/year/" +
          yearHidden +
          "/month/" +
          monthHidden +
          "/drink/" +
          alcoholOrNotHidden+
          "/degree/" +
          uri,
        type: "GET",
        dataType: "json",
        success: function (response) {
          console.log(response);
          var len = response.length;
          var accident_cnt = 0;
          var dead_cnt = 0;
          var injury_cnt = 0;
          for(var i=0; i<len; i++){
            accident_cnt += response[i].사고건수;

            dead_cnt += response[i].사망자수;

            injury_cnt += response[i].부상자수;

            $("#accidentsAccidents").text(accident_cnt);
            $("#accidentsDead").text(dead_cnt);
            $("#accidentsInjury").text(injury_cnt);
          }
        },
      });
    });
  </script>
</html>
